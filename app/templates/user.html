{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}
<div class="container">
    <table>
        <tr valign="top">
            <h1>{{ user.username }}</h1>
			{% if user.about_me %}<p>{{ user.about_me }}</p>{% endif %}
            {% if user.last_seen %}<p>Last seen on: {{ user.last_seen }}</p>{% endif %}
			<p>{{ user.followers.count() }} followers, {{ user.followed.count() }} following.</p>
			{% if current_user.is_authenticated %}{% if user == current_user %}
			<p><a href="{{ url_for('edit_profile') }}">Edit your profile</a></p>
			{% elif not current_user.is_following(user) %}
			<p><button class="btn btn-sm btn-info" href="{{ url_for('follow', username=user.username) }}">Follow</button></p>
			{% else %}
			<p><button class="btn btn-sm btn-warning" href="{{ url_for('unfollow', username=user.username) }}">Unfollow</button></p>
			{% endif %}{% endif %}
			
    </table>
    <hr>
    <div class="row">
		<div class="col-md-6">
			{% if current_user.is_authenticated %}
			{% if user == current_user %}
			<p><button class="btn btn-default" href="#" data-toggle="modal" data-target="#create_project_modal" style="float:right;"><strong>Create Project</strong></button></p>
			{% endif %}
			{% endif %}
			<h3>Portfolio</h3>
			<ul class="nav nav-pills nav-stacked" role="tablist">
				{% if portfolio %}
				{% for p in portfolio %}
				{% if current_user.is_authenticated and user == current_user or  current_user.is_authenticated and current_user.is_superuser() == True %}
				<li>
					{% if p.date_published %}
					<a href="{{ url_for('project', id=p.id, title=p.title) }}">
						<span> {{ p.title }} </span> 
						<span style="float:right;"> Published: {{ moment(p.date_published).format('L') }}  &nbsp;</span>
					</a>
					{% else %}
					<a href="{{ url_for('project', id=p.id, title=p.title) }}" style="width:75%; display:inline-flex;">
						<span> {{ p.title }} </span> 
					</a>
					<a href="#" data-toggle="modal" data-target="#project_edit_modal_{{ p.id }}" style="width:8%;display:inline-flex;">
						<span class="glyphicon glyphicon-pencil" title="edit project name" aria-hidden="true" style="float:right;"></span>
					</a>
					<a href="#" data-toggle="modal" data-target="#project_delete_modal_{{ p.id }}" style="width:8%;display:inline-flex;">
						<span class="glyphicon glyphicon-trash" title="delete project" aria-hidden="true" style="float:right;"></span>
					</a>
					{% endif %}
				</li>
				{% else %}
					{% if p.date_published %}
					<li><a href="{{ url_for('project_synopsis', id=p.id, title=p.title) }}"><span> {{ p.title }} </span> <span style="float:right;">{% if p.date_published %} Published: {{ moment(p.date_published).format('L') }} {% endif %}</span></a></li>
					{% else %}
					<li role="presentation"><a href="#" data-toggle="modal" data-target="#project_modal_{{ p.id }}">{{ p.title }}</a></li>
					{% endif %}
				{% endif %}
				{% endfor %}
				{% endif %}
			</ul>
		</div>
		<div class="col-md-6">
			<h3>Library</h3>
			<ul class="nav nav-pills nav-stacked" role="tablist">
				{% if library %}
				{% for l in library %}
				{% if current_user.is_authenticated and user == current_user %}
				<li><a href="{{ url_for('project', id=l.id, title=l.title) }}"><span> {{ l.title }} </span> <span style="float:right;"> Published: {{ moment(l.date_published).format('L') }}</span></a></li>
				{% else %}
				<li><a href="{{ url_for('project_synopsis', id=l.id, title=l.title) }}"><span> {{ l.title }} </span> <span style="float:right;"> Published: {{ moment(l.date_published).format('L') }}</span></a></li>
				<!--li role="presentation"><a href="#" data-toggle="modal" data-target="#library_modal_{{ l.id }}">{{ l.title }}</a></li-->
				{% endif %}
				{% endfor %}
				{% endif %}
			</ul>
		</div>
	</div>
	
	<div class="modal fade" id="create_project_modal" tabindex="-1" role="dialog" aria-labelledby="create_project_modalLabel">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-body">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			{{ wtf.quick_form(form) }}
		  </div>
		</div>
	  </div>
	</div>
	{% if portfolio %}
	{% for p in portfolio %}
	{% if current_user.is_anonymous or user != current_user %}
	<div class="modal fade" id="project_modal_{{ p.id }}" tabindex="-1" role="dialog" aria-labelledby="project_{{p.id}}_modalLabel">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-body">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h2 class="text-center">{{ p.title }}</h2>
			<div>{{ p.synopsis }}</div>
		  </div>
		</div>
	  </div>
	</div>
	{% endif %}
	
	{% if current_user.is_authenticated and user == current_user or current_user.is_authenticated and current_user.is_superuser() == True %}
	<div class="modal fade" id="project_edit_modal_{{ p.id }}" tabindex="-1" role="dialog" aria-labelledby="project_{{p.id}}_edit_modalLabel">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-body">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<form action method="post" class="form" role="form">
			{{ form2.csrf_token() }}
			{{ form2.proj_id (value=p.id)}}
			{{ form2.edit_title.label (class_='control-label') }}
			{{ form2.edit_title (class_='form-control', value=p.title) }}
			{{ form2.edit_genre.label (class_='control-label') }}
			{{ form2.edit_genre (class_='form-control', value=p.pg_name) }}
			<br>
			{{ form2.edit_synopsis.label (class_='control-label') }}
			<textarea class="form-control" name="edit_synopsis" cols="15" rows="20" maxlength="50000" required>{{p.synopsis}}</textarea>
			<br>
			{{ form2.edit_submit (class_="btn btn-default")}}
			</form>
		  </div>
		</div>
	  </div>
	</div>
	
	<div class="modal fade" id="project_delete_modal_{{ p.id }}" tabindex="-1" role="dialog" aria-labelledby="project_{{p.id}}_delete_modalLabel" style="margin-top: 10%;">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-body">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<div><h4>Are you sure you want to delete this project and its chapters?<h4></div>
			<div><a class="btn btn-danger" href="{{ url_for('quarantine_project', id=p.id) }}">Delete</a></div>
		  </div>
		</div>
	  </div>
	</div>
	{% endif %}
	{% endfor %}
	{% endif %}
	
	{% if current_user.is_authenticated and user != current_user %}
	{% if library %}
	{% for l in library %}
	<div class="modal fade" id="library_modal_{{ l.id }}" tabindex="-1" role="dialog" aria-labelledby="library_{{ l.id }}modalLabel">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-body">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h2 class="text-center">{{ l.title }}</h2>
			<div>{{ l.synopsis }}</div>
		  </div>
		</div>
	  </div>
	</div>
	{% endfor %}
	{% endif %}
	{% endif %}
</div>
{% endblock %}

{% block scripts %}
{{super()}}
<!--set value of textarea -->
<script>
$(document).ready(function() {

});
</script>
{% endblock %}